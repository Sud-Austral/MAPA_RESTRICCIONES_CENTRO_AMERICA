<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chatbot - reas Protegidas de Belice</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary-color: #1e88e5;
            --primary-dark: #1565c0;
            --primary-light: #64b5f6;
            --secondary-color: #43a047;
            --accent-color: #ff7043;
            --background: #f5f7fa;
            --surface: #ffffff;
            --text-primary: #212121;
            --text-secondary: #757575;
            --divider: #e0e0e0;
            --shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            --shadow-hover: 0 5px 15px rgba(0, 0, 0, 0.2);
            --radius: 12px;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Roboto', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: var(--text-primary);
            line-height: 1.6;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 0;
            margin: 0;
            position: relative;
            overflow-x: hidden;
        }

        /* Fondo animado */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1000 1000"><defs><pattern id="leaf" patternUnits="userSpaceOnUse" width="100" height="100"><g fill="rgba(255,255,255,0.1)"><path d="M50 10c20 0 30 15 30 40-5-20-15-30-30-30s-25 10-30 30c0-25 10-40 30-40z"/></g></pattern></defs><rect width="100%" height="100%" fill="url(%23leaf)"/></svg>') repeat;
            opacity: 0.1;
            z-index: -1;
            animation: float 20s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0px) rotate(0deg); }
            50% { transform: translateY(-20px) rotate(5deg); }
        }

        .container {
            width: 100vw;
            height: 100vh;
            max-width: none;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 0;
            box-shadow: none;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            max-height: none;
            border: none;
            position: relative;
        }

        .header {
            background: linear-gradient(135deg, var(--primary-color), var(--primary-dark));
            color: white;
            padding: 20px;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .header::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(45deg, transparent, rgba(255,255,255,0.1), transparent);
            transform: rotate(45deg);
            animation: shimmer 3s infinite;
        }

        @keyframes shimmer {
            0% { transform: translateX(-100%) translateY(-100%) rotate(45deg); }
            100% { transform: translateX(100%) translateY(100%) rotate(45deg); }
        }

        .header h1 {
            font-size: 32px;
            font-weight: 600;
            margin: 0;
            position: relative;
            z-index: 2;
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 18px;
            opacity: 0.95;
            margin-top: 8px;
            position: relative;
            z-index: 2;
        }

        .header::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: linear-gradient(90deg, var(--accent-color), var(--secondary-color));
        }

        .chat-container {
            flex: 1;
            overflow-y: auto;
            padding: 25px;
            background: linear-gradient(to bottom, #f8f9fa, #e9ecef);
            display: flex;
            flex-direction: column;
            gap: 20px;
            position: relative;
            font-size: 18px;
        }

        .message {
            display: flex;
            margin-bottom: 5px;
            animation: fadeInUp 0.4s ease-out;
        }

        @keyframes fadeInUp {
            from { 
                opacity: 0; 
                transform: translateY(20px); 
            }
            to { 
                opacity: 1; 
                transform: translateY(0); 
            }
        }

        .user-message {
            justify-content: flex-end;
        }

        .bot-message {
            justify-content: flex-start;
        }

        .message-content {
            max-width: 75%;
            padding: 20px 24px;
            border-radius: 20px;
            position: relative;
            word-wrap: break-word;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
            font-size: 18px;
            line-height: 1.5;
        }

        .message-content:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(0,0,0,0.15);
        }

        .user-message .message-content {
            background: linear-gradient(135deg, var(--primary-color), var(--primary-dark));
            color: white;
            border-bottom-right-radius: 5px;
            position: relative;
        }

        .user-message .message-content::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, rgba(255,255,255,0.1), transparent);
            border-radius: inherit;
            pointer-events: none;
        }

        .bot-message .message-content {
            background: linear-gradient(135deg, #ffffff, #f8f9fa);
            color: var(--text-primary);
            border: 1px solid rgba(30, 136, 229, 0.1);
            border-bottom-left-radius: 5px;
        }

        .input-container {
            display: flex;
            padding: 15px;
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            border-top: 1px solid var(--divider);
            gap: 10px;
            align-items: center;
        }

        #user-input {
            flex: 1;
            padding: 14px 20px;
            border: 2px solid var(--divider);
            border-radius: 25px;
            outline: none;
            font-size: 15px;
            transition: all 0.3s ease;
            background: white;
        }

        #user-input:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(30, 136, 229, 0.1);
            transform: translateY(-1px);
        }

        #send-button {
            background: linear-gradient(135deg, var(--primary-color), var(--primary-dark));
            color: white;
            border: none;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            box-shadow: 0 4px 12px rgba(30, 136, 229, 0.3);
        }

        #send-button:hover {
            transform: scale(1.1) translateY(-2px);
            box-shadow: 0 6px 16px rgba(30, 136, 229, 0.4);
        }

        #send-button:active {
            transform: scale(0.95);
        }

        .typing-indicator {
            display: none;
            padding: 10px 20px;
            color: var(--text-secondary);
            font-style: italic;
            font-size: 14px;
            animation: pulse 1.5s infinite;
            text-align: center;
        }

        @keyframes pulse {
            0% { opacity: 0.6; }
            50% { opacity: 1; }
            100% { opacity: 0.6; }
        }

        .typing-indicator.active {
            display: block;
        }

        .bot-avatar, .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            flex-shrink: 0;
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
            transition: all 0.3s ease;
        }

        .bot-avatar {
            background: linear-gradient(135deg, var(--secondary-color), #2e7d32);
            margin-right: 12px;
        }

        .user-avatar {
            background: linear-gradient(135deg, var(--accent-color), #e64a19);
            margin-left: 12px;
        }

        .bot-avatar:hover, .user-avatar:hover {
            transform: scale(1.1);
        }

        .message-wrapper {
            display: flex;
            align-items: flex-end;
            max-width: 85%;
        }

        .bot-message .message-wrapper {
            flex-direction: row;
        }

        .user-message .message-wrapper {
            flex-direction: row-reverse;
            margin-left: auto;
        }

        .timestamp {
            font-size: 11px;
            color: var(--text-secondary);
            margin-top: 6px;
            text-align: right;
            opacity: 0.7;
        }

        .bot-message .timestamp {
            text-align: left;
        }

        .footer {
            padding: 12px 15px;
            text-align: center;
            font-size: 12px;
            color: var(--text-secondary);
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            border-top: 1px solid var(--divider);
        }

        /* Mejoras para dispositivos m贸viles */
        @media (max-width: 768px) {
            body {
                padding: 5px;
            }
            
            .container {
                height: 100vh;
                max-height: none;
                border-radius: 0;
                max-width: none;
            }
            
            .header {
                padding: 15px 10px;
            }
            
            .header h1 {
                font-size: 20px;
            }
            
            .header p {
                font-size: 13px;
            }
            
            .chat-container {
                padding: 10px;
            }
            
            .message-content {
                max-width: 85%;
                padding: 12px 16px;
                font-size: 14px;
            }
            
            .bot-avatar, .user-avatar {
                width: 36px;
                height: 36px;
            }
            
            .bot-avatar {
                margin-right: 8px;
            }
            
            .user-avatar {
                margin-left: 8px;
            }
            
            .input-container {
                padding: 12px 10px;
            }
            
            #user-input {
                padding: 12px 16px;
                font-size: 16px; /* Evita zoom en iOS */
            }
            
            #send-button {
                width: 45px;
                height: 45px;
            }
        }

        @media (max-width: 480px) {
            .header h1 {
                font-size: 18px;
            }
            
            .header p {
                font-size: 12px;
            }
            
            .message-content {
                max-width: 90%;
                padding: 10px 14px;
            }
            
            .bot-avatar, .user-avatar {
                width: 32px;
                height: 32px;
            }
            
            #user-input {
                padding: 10px 14px;
            }
            
            #send-button {
                width: 42px;
                height: 42px;
            }
        }

        /* Mejoras para tablets */
        @media (min-width: 769px) and (max-width: 1024px) {
            .container {
                max-width: 700px;
                height: 80vh;
            }
            
            .message-content {
                max-width: 70%;
            }
        }

        /* Mejoras para pantallas grandes */
        @media (min-width: 1200px) {
            .container {
                max-width: 1000px;
            }
        }

        /* Scrollbar styling mejorado */
        .chat-container::-webkit-scrollbar {
            width: 8px;
        }

        .chat-container::-webkit-scrollbar-track {
            background: rgba(0,0,0,0.1);
            border-radius: 4px;
        }

        .chat-container::-webkit-scrollbar-thumb {
            background: linear-gradient(135deg, var(--primary-light), var(--primary-color));
            border-radius: 4px;
            transition: background 0.3s ease;
        }

        .chat-container::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(135deg, var(--primary-color), var(--primary-dark));
        }

        /* Efectos de entrada para el contenedor */
        .container {
            animation: slideInUp 0.6s ease-out;
        }

        @keyframes slideInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Mejoras de accesibilidad */
        @media (prefers-reduced-motion: reduce) {
            *, *::before, *::after {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
            }
        }

        /* Dark mode support */
        @media (prefers-color-scheme: dark) {
            :root {
                --background: #1a1a1a;
                --surface: #2d2d2d;
                --text-primary: #ffffff;
                --text-secondary: #b0b0b0;
                --divider: #404040;
            }
            
            .container {
                background: rgba(45, 45, 45, 0.95);
            }
            
            .chat-container {
                background: linear-gradient(to bottom, #2d2d2d, #1a1a1a);
            }
            
            .bot-message .message-content {
                background: linear-gradient(135deg, #3d3d3d, #2d2d2d);
                border-color: rgba(30, 136, 229, 0.3);
            }
        }

        /* Mejoras para orientaci贸n landscape en m贸viles */
        @media (max-height: 500px) and (orientation: landscape) {
            .container {
                height: 95vh;
            }
            
            .header {
                padding: 10px;
            }
            
            .header h1 {
                font-size: 18px;
            }
            
            .header p {
                display: none;
            }
            
            .chat-container {
                padding: 8px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1><i class="fas fa-leaf"></i> Informaci贸n geoespacial para el cumplimiento del Reglamento Europeo sobre Productos Libres de Deforestaci贸n (EUDR)
 </h1>
            <p>Consulta informaci贸n sobre restricciones, geoprocesos y regulaciones ambientales</p>
        </div>
        <div class="chat-container" id="chat-container">
            <div class="message bot-message">
                <div class="message-wrapper">
                    <div class="bot-avatar">
                        <i class="fas fa-leaf"></i>
                    </div>
                    <div>
                        <div class="message-content">
                            隆Hola!  Soy tu asistente especializado en 谩reas protegidas. Puedes preguntarme sobre restricciones, geoprocesos o cualquier aspecto relacionado con los datos disponibles. 驴En qu茅 puedo ayudarte hoy?
                        </div>
                        <div class="timestamp">Hoy, 10:30 AM</div>
                    </div>
                </div>
            </div>
        </div>
        <div class="typing-indicator" id="typing-indicator">
            <i class="fas fa-robot"></i> Escribiendo respuesta...
        </div>
        <div class="input-container">
            <input type="text" id="user-input" placeholder="Escribe tu pregunta aqu铆..." />
            <button id="send-button" aria-label="Enviar mensaje">
                <i class="fas fa-paper-plane"></i>
            </button>
        </div>
        <div class="footer">
            <i class="fas fa-shield-alt"></i> Asistente de Consultas - reas Protegidas de Belice 漏 2024
        </div>
    </div>

    <script src="db.js"></script>
    <script>
        // Base de datos simulada - Reemplaza con tu archivo db.json real
        

        // Configuraci贸n de la API de Gemini
        const apiKey = 'AIzaSyDLzplCcOl_xbZWghCnwCP9Qmw7cE_eg6o';
        const url = `https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash-latest:generateContent?key=${apiKey}`;

        // Historial de la conversaci贸n
        let historialConversacion = [];

        // Elementos del DOM
        const chatContainer = document.getElementById('chat-container');
        const userInput = document.getElementById('user-input');
        const sendButton = document.getElementById('send-button');
        const typingIndicator = document.getElementById('typing-indicator');

        // Event listeners
        sendButton.addEventListener('click', sendMessage);
        userInput.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                sendMessage();
            }
        });

        // Prevenir zoom en iOS cuando se enfoca el input
        userInput.addEventListener('touchstart', function() {
            userInput.style.fontSize = '16px';
        });

        // Funci贸n para enviar mensajes
        async function sendMessage() {
            const message = userInput.value.trim();
            if (message === '') return;

            // Deshabilitar bot贸n y input durante el env铆o
            sendButton.disabled = true;
            userInput.disabled = true;

            // Agregar mensaje del usuario al chat
            addMessageToChat('user', message);
            userInput.value = '';

            // Mostrar indicador de escritura
            typingIndicator.classList.add('active');
            chatContainer.scrollTop = chatContainer.scrollHeight;

            // Obtener respuesta del bot
            const response = await obtenerRespuesta(message);

            // Ocultar indicador de escritura
            typingIndicator.classList.remove('active');

            // Agregar respuesta del bot al chat
            addMessageToChat('bot', response);

            // Rehabilitar bot贸n y input
            sendButton.disabled = false;
            userInput.disabled = false;
            userInput.focus();
        }

        // Funci贸n para agregar mensajes al chat
        function addMessageToChat(sender, message) {
            const messageDiv = document.createElement('div');
            messageDiv.classList.add('message');
            messageDiv.classList.add(sender === 'user' ? 'user-message' : 'bot-message');

            const messageWrapper = document.createElement('div');
            messageWrapper.classList.add('message-wrapper');

            // Crear avatar
            const avatar = document.createElement('div');
            avatar.classList.add(sender === 'user' ? 'user-avatar' : 'bot-avatar');
            avatar.innerHTML = sender === 'user' ? '<i class="fas fa-user"></i>' : '<i class="fas fa-leaf"></i>';

            // Crear contenido del mensaje
            const messageContent = document.createElement('div');
            messageContent.classList.add('message-content');
            messageContent.innerHTML = formatMessage(message);

            // Crear timestamp
            const timestamp = document.createElement('div');
            timestamp.classList.add('timestamp');
            const now = new Date();
            timestamp.textContent = `Hoy, ${now.getHours()}:${now.getMinutes().toString().padStart(2, '0')}`;

            // Estructurar el mensaje
            const messageInfo = document.createElement('div');
            messageInfo.appendChild(messageContent);
            messageInfo.appendChild(timestamp);

            if (sender === 'user') {
                messageWrapper.appendChild(messageInfo);
                messageWrapper.appendChild(avatar);
            } else {
                messageWrapper.appendChild(avatar);
                messageWrapper.appendChild(messageInfo);
            }

            messageDiv.appendChild(messageWrapper);
            chatContainer.appendChild(messageDiv);

            // Scroll al final del chat con animaci贸n suave
            setTimeout(() => {
                chatContainer.scrollTo({
                    top: chatContainer.scrollHeight,
                    behavior: 'smooth'
                });
            }, 100);
        }

        // Funci贸n para formatear mensajes (admite markdown b谩sico)
        function formatMessage(message) {
            return message
                .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
                .replace(/\*(.*?)\*/g, '<em>$1</em>')
                .replace(/\n/g, '<br>');
        }

        // Funci贸n para obtener respuesta de la API de Gemini
        async function obtenerRespuesta(pregunta) {
            // Agregar la pregunta del usuario al historial
            historialConversacion.push({
                role: "user",
                parts: [{ text: pregunta }]
            });

            // Crear el prompt con la base de datos y la pregunta
            const promptBase = `Eres un asistente experto en 谩reas protegidas y regulaciones ambientales en Belice.
            Tu funci贸n es responder preguntas bas谩ndote exclusivamente en la siguiente base de datos:

            ${JSON.stringify(datos)}

            Instrucciones:
            1. Responde de manera clara, concisa y amigable.
            2. Si la informaci贸n para responder la pregunta est谩 en la base de datos, 煤sala.
            3. Si la informaci贸n no est谩 en la base de datos, indica amablemente que no tienes esa informaci贸n espec铆fica.
            4. Mant茅n un tono profesional pero accesible y usa emojis ocasionalmente.
            5. Ofrece preguntas de seguimiento relacionadas con el tema cuando sea apropiado.
            6. No inventes informaci贸n que no est茅 en la base de datos.
            7. Puedes hacer referencia a los IDs de restricci贸n o datos cuando sea relevante.
            8. Usa formato de texto enriquecido cuando sea apropiado (**negrita**, *cursiva*).

            Pregunta del usuario: ${pregunta}`;

            // Preparar contenidos para Gemini
            const contenidos = [
                {
                    role: "user",
                    parts: [{ text: promptBase }]
                }
            ];

            // Agregar historial de conversaci贸n (m谩ximo 煤ltimas 10 interacciones)
            const historialReciente = historialConversacion.slice(-10);
            contenidos.push(...historialReciente);

            const requestBody = {
                contents: contenidos,
                generationConfig: {
                    temperature: 0.7,
                    maxOutputTokens: 1000,
                }
            };

            try {
                const response = await fetch(url, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(requestBody)
                });

                if (!response.ok) {
                    throw new Error(`Error en la petici贸n: ${response.status} ${response.statusText}`);
                }

                const dataResp = await response.json();

                // Manejo seguro de la respuesta
                if (dataResp?.candidates?.[0]?.content?.parts?.[0]?.text) {
                    const respuesta = dataResp.candidates[0].content.parts[0].text.trim();
                    
                    // Agregar la respuesta del modelo al historial
                    historialConversacion.push({
                        role: "model",
                        parts: [{ text: respuesta }]
                    });

                    return respuesta;
                } else {
                    throw new Error("Respuesta inesperada de la API de Gemini");
                }
            } catch (error) {
                console.error("Error al llamar a la API de Gemini:", error);
                return "Lo siento, ocurri贸 un error al procesar tu pregunta.  Por favor, intenta nuevamente m谩s tarde o verifica tu conexi贸n a internet.";
            }
        }

        // Funci贸n para limpiar el historial
        function limpiarHistorial() {
            historialConversacion = [];
            localStorage.removeItem('chatHistory');
        }

        // Auto-focus en el input al cargar la p谩gina
        window.addEventListener('load', () => {
            userInput.focus();
        });

        // Manejar cambios de orientaci贸n en dispositivos m贸viles
        window.addEventListener('orientationchange', () => {
            setTimeout(() => {
                chatContainer.scrollTop = chatContainer.scrollHeight;
            }, 300);
        });
    </script>
</body>
</html>